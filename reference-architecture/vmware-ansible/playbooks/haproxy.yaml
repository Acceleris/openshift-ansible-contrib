---
- hosts: localhost
  vars_files:
    - vars/main.yaml
  roles:
    - create-vm-haproxy

- name: Deploy ha proxy server
  hosts: haproxy
  vars_files:
    - vars/main.yaml
  roles:
    - rhsm
    - vmware-guest-setup
  ignore_errors: yes

- name: Configure ha proxy server
  hosts: haproxy
  vars_files:
    - vars/main.yaml
  roles:
    - haproxy-server

- name: Configure ha proxy server files
  hosts: haproxy, masters, infras
  vars_files:
    - vars/main.yaml
  roles:
    - haproxy-server-config

- name: Configure ha proxy server files
  hosts: haproxy
  vars_files:
    - vars/main.yaml
  roles:
    - keepalived_haproxy
